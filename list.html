<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>View List</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- External Scripts -->
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script src="http://www.w3schools.com/lib/w3data.js"></script>

    <!-- Local Scripts -->
    <script src="js/methods.js"></script>
    <!-- <script src="js/profile.js"></script> -->

  	<script type="text/javascript">
  	var count = 1;

  		$(document).ready(function() {
  			setUpPage();
  		})

  		function setUpPage() {
	  		var current_url = window.location.href;
	  		var list_ID = current_url.split('#')[1];

			$.post("php/get-movies-in-list.php", {list_ID: list_ID},
	              function (data) {  
	                var result = JSON.parse(data);
	                for(var i = 1; i < result.length; i++) {
	                  var movie = result[i].Name;
	                  var avg_review = result[i].AvgReview;
	                  var image = result[i].ImageName;
	                  displayMovie(i, movie, avg_review, image);
	                }
	          }); 
          }	

          function displayMovie(i, name, avg_review, image) {
          		$("#body").append("<tr>" + 
	              	"<th scope='row'>" + i + "</th>" + 
	              	"<td><img src='images/" + image + "' class='img-thumbnail' alt='" + name + "' width='100' height='100'>" + "</td>" + 
	              	"<td>" + name + "</td>" +
	              	"<td>" + avg_review + "</td>" + 
	              	"</tr>");
          		count ++;
          }

          function addMovie() {
          	// TODO: Allow users to upload files and modify "ImageName" category of movies
          	var name = $("#name").val();
          	var current_url = window.location.href;
          	var list_ID = current_url.split('#')[1];

          	$.post("php/add-movie.php", {name: name, list_ID: list_ID}, function(data) {
          		displayMovie(count, name, -1, "default.jpg"); 

          	});
          }	
  	</script>
  	</head>
  	<body>
		<table class="table" id="listDisplay">
		  <thead>
		    <tr>
		      <th>#</th>
		      <th>Image</th>
		      <th>Movie Name</th>
		      <th>Average Review</th>
		    </tr>
		  </thead>
		  <tbody id="body">
		  </tbody>
		</table>

		<div class="form-group">
	  		<div id='response'></div>
	    	<label for="name">Add a movie to list</label>
		    <input type="text" class="form-control" id="name" name="name" aria-describedby="help" placeholder="Enter name of movie">
		</div>
		  <button type="submit" onclick="addMovie()" class="btn btn-primary">Add</button>

	</body>
</html>