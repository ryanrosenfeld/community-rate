<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Profile</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- External Scripts -->
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script src="http://www.w3schools.com/lib/w3data.js"></script>

    <!-- Local Scripts -->
    <script src="js/methods.js"></script>
    <!-- <script src="js/profile.js"></script> -->

  	<script type="text/javascript">
  		$(document).ready(function() {
  			setUpPage();
  		})

      function setUpPage() {
        getLists();
        $.post("php/get-reviews.php", function(data) {
          if (data.trim() !== "none") {
            reviews = jQuery.parseJSON(data);
            listFavorites();
            listRecents();
            getFriendships();
            $('#numSeen').append(reviews.length);
          }
        });
      }

      function listFavorites() {
        var favoriteList = reviews;
        favoriteList.sort(function(a,b) {
          return b.Rating - a.Rating;
        });
        listReviews(favoriteList, "favoritesList");
        findFavorite(favoriteList);
      }

      function listRecents() {
        var recentList = reviews;
        recentList.sort(function(a,b) {
          if (a.DateReviewed > b.DateReviewed) {
            return -1;
          }
          else if (a.DateReviewed < b.DateReviewed) {
            return 1;
          }
          return 0;
        })
        listReviews2(recentList, "recentsList");
      }

      function getLists() {
          $.post("php/get-lists.php", 
              function (data) {  

                var result = JSON.parse(data);
                for(var i = 1; i < result.length; i++) {
                  var list_name = result[i].Name;
                  var ID = result[i].ID;
                  //var creator = result[i].Creator;
                  //var description = result[i].Description;
                  $("#listDisplay").append("<li class=\"list-group-item\"><a href='list.html#" + ID + "'>" + list_name +"</a></li>");
                }
          });
        
      }

      function listReviews(list, divId) {
        var count = 0;
        var rating = Array();
        for (var i = 0; i < list.length; i++) {
          var id = list[i].Movie_ID;
          rating.push(list[i].Rating);
          console.log(id);
          searchById(id, function(rsp) {
            console.log(rsp);
            var img = getPosterImgSrc(rsp, "w92");
            var innerHTML = "<div class='col-md-1'><img src="+ img + " alt='' height='50' width='50'></div>"
              + "<div class='col-md-11'><h4 class='list-group-item-heading'>" + rsp.title + "</h4>"
              + "<p class='list-group-item-text'>Rating: " + rating[count] + "</p></div>";
            addToListGroup(innerHTML, divId, "onclick='goToMovie(" + rsp.id + ")'");
            count++;
          })
        }
      }

      function listReviews2(list, divId) {
        var count = 0;
        var rating = Array();
        for (var i = 0; i < list.length; i++) {
          var id = list[i].Movie_ID;
          rating.push(list[i].Rating);
          console.log(id);
          searchById(id, function(rsp) {
            console.log(rsp);
            var img = getPosterImgSrc(rsp, "w92");
            var innerHTML = "<div class='col-md-1'><img src="+ img + " alt='' height='50' width='50'></div>"
              + "<div class='col-md-11'><h4 class='list-group-item-heading'>" + rsp.title + "</h4>"
              + "<p class='list-group-item-text'>Rating: " + rating[count] + "</p></div>";
            addToListGroup(innerHTML, divId, "onclick='goToMovie(" + rsp.id + ")'");
            //var img = getPosterImgSrc(rsp, "w92");
            count++;
          })
        }
      }

      function findFavorite(sortedReviews) {
        var id = sortedReviews[0].Movie_ID;
        searchById(id, function(rsp) {
          $('#favMovie').append(rsp.title);
        })
      }

      function getFriendships() {
        console.log("Here");
        $.post("php/get-friendships.php", function (rsp) {
          rsp = JSON.parse(rsp);
          console.log(rsp);
          var followers = rsp[0];
          var following = rsp[1];
          $('#followersBadge').text(followers.length);
          $('#followingBadge').text(following.length);
          for (var i = 0; i < followers.length; i++) {
            addToListGroup(followers[i].Name, "followersList");
          }
          for (var i = 0; i < following.length; i++) {
            addToListGroup(following[i].Name, "followingList");
          }
          $('#followersList').hide();
          $('#followingList').hide();
        })
      }

      function showFollowers() {
        $('#followersList').show();
      }

      function showFollowing() {
        $('#followingList').show();
      }
  	</script>
  </head>
  <body>
    <script type="text/javascript">
      checkForUser();
    </script>

  	<!-- Navbar -->
    <div w3-include-html="partials/navbar.html"></div>

    <div class="container">
    	<!-- Left column -->
      <div class="col-md-4">
      	<div class="page-header">
    	  	<h3>Ryan Rosenfeld</h3>
      	</div>
        <p id="numSeen">Movie Reactions: </p>
        <p id="favMovie">Favorite Movie: </p>
        <p id="favGenre">Favorite Genre: </p>
        <div class="col-md-10">
          <ul class="nav nav-tabs">
            <li><a data-toggle="tab" href="#followers" onclick="showFollowers()">Followers <span class="badge" id="followersBadge"></span></a></li>
            <li><a data-toggle="tab" href="#following" onclick="showFollowing()">Following <span class="badge" id="followingBadge"></span></a></li>
          </ul>

          <div class="tab-content">
            <!-- Followers -->
            <div id="followers" class="tab-pane fade in active">
              <div class="list-group" id="followersList"></div>
            </div>

            <!-- Following -->
            <div id="following" class="tab-pane fade in active">
              <div class="list-group" id="followingList"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right column -->
      <div class="col-md-8">

        <!-- Tabs -->
        <ul class="nav nav-tabs">
          <li class="active"><a data-toggle="tab" href="#favorites">Favorites</a></li>
          <li><a data-toggle="tab" href="#recents">Recently Watched</a></li>
          <li><a data-toggle="tab" href="#lists">Lists</a></li>
        </ul>

        <div class="tab-content">
          <!-- Favorite Movies -->
          <div id="favorites" class="tab-pane fade in active">
              <br>
              <div class="list-group" id="favoritesList"></div>
          </div>

          <!-- Recent Movies -->
          <div id="recents" class="tab-pane fade">
            <br>
            <div class="list-group" id="recentsList"></div>
          </div>

          <!-- Lists -->
          <div id="lists" class="tab-pane fade">
            <ul class="list-group" id="listDisplay"></ul>
          </div>
        </div>
      </div>
    </div>      

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script> -->
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <script type="text/javascript">
    	//Global variables
    	var maxGroupDisplay = 10;
      var reviews;
      var movieInfo;

      //Include Partials
      w3IncludeHTML();
    </script>
  </body>
</html>